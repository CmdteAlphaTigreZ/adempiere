language: java
jdk:
  - oraclejdk8
os:
  - linux
before_install:
 - cd utils_dev
jobs:
  include:
    - stage: Main Build Test
      script: ant build
before_deploy:
  # Set up git user name and tag this commit
  - git config --local user.name "YamelSenih"
  - git config --local user.email "yamelsenih@gmail.com"
  - git tag "$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)"
deploy:
      provider: releases
      api_key: "$access_key_id"
      file: 
        - "install/build/Adempiere_390LTS.tar.gz"
        - "install/build/Adempiere_390LTS.tar.gz.MD5"
        - "install/build/Adempiere_390LTS.zip"
        - "install/build/Adempiere_390LTS.zip.MD5"
      on:
        tags: true
        all_branches: true
      skip_cleanup: true
notifications:
  email:
    recipients:
      - ysenih@erpya.com
      - info@erpya.com
    on_success: always # default: change
    on_failure: always # default: always
addons:
  ssh_known_hosts:
  - $REMOTE_HOST
after_success:
  - cd ..
  - "./deploy.sh"