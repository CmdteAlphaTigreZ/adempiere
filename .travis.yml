language: java
jdk:
- openjdk8
install: gradle wrapper
os:
- linux
sudo: required
before_install:
  - wget https://services.gradle.org/distributions/gradle-6.1.1-bin.zip
  - unzip -qq gradle-6.1.1-bin.zip
  - export GRADLE_HOME=$PWD/gradle-6.1.1
  - export PATH=$GRADLE_HOME/bin:$PATH
  - gradle -v
addons:
  apt:
    packages:
      ant
jobs:
  include:
  - stage: Main Build Test
    script: gradle buildWithAnt
deploy:
  provider: releases
  api_key: $GITHUB_TOKEN_KEY
  file: 
    - "$TRAVIS_BUILD_DIR/adempiere/install/Adempiere_393LTS.tar.gz"
    - "$TRAVIS_BUILD_DIR/adempiere/install/Adempiere_393LTS.tar.gz.MD5"
    - "$TRAVIS_BUILD_DIR/adempiere/install/Adempiere_393LTS.zip"
    - "$TRAVIS_BUILD_DIR/adempiere/install/Adempiere_393LTS.zip.MD5"
  skip_cleanup: true
  on:
    tags: true
